<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>sparseHessianFD — sparseHessianFD • sparseHessianFD</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="sparseHessianFD — sparseHessianFD"><meta property="og:description" content="A reference class for computing sparse Hessians"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-HJZLF2TRPM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HJZLF2TRPM');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sparseHessianFD</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.3.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/braunm/sparseHessianFD/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>sparseHessianFD</h1>
    <small class="dont-index">Source: <a href="https://github.com/braunm/sparseHessianFD/blob/HEAD/R/sparseHessianFD-class.R" class="external-link"><code>R/sparseHessianFD-class.R</code></a></small>
    <div class="hidden name"><code>sparseHessianFD.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A reference class for computing sparse Hessians</p>
    </div>


    <div id="details">
    <h2>Details</h2>
    <p>The sparseHessianFD function calls the initializer for the
sparseHessianFD class, and returns a sparseHessianFD object.</p><div class="sourceCode"><pre><code><span><span class="fu"><a href="../reference/sparseHessianFD.html">sparseHessianFD</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">fn</span>, <span class="va">gr</span>, <span class="va">rows</span>, <span class="va">cols</span>, <span class="va">delta</span>, <span class="va">index1</span>, <span class="va">complex</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p>The function, gradient and sparsity pattern are
declared as part of the initialization.</p>
<p>Once initialized, the $hessian method will evaluate the Hessian at x.</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">sparseHessian</span><span class="op">(</span><span class="va">x</span>, <span class="va">fn</span>, <span class="va">gr</span>, <span class="va">rows</span>, <span class="va">cols</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">hessian</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div><p>For convenience, the class provides wrapper methods to the <code>fn</code> and <code>gr</code> functions that were specified in the initializer.</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## wrapper to objective function</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## wrapper to gradient</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">fngr</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## list of obj function and gradient</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">fngrhs</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## list of obj function, gradient and Hessian.</span></span></code></pre></div>
<div class="section">
<h3 id="arguments-to-initializer">Arguments to initializer<a class="anchor" aria-label="anchor" href="#arguments-to-initializer"></a></h3>

<dl><dt>x</dt>
<dd><p>an vector at which the function, gradient and Hessian are initialized and tested.</p></dd>

<dt>fn, gr</dt>
<dd><p>R functions that return the function value and
gradient, evaluated at x.</p></dd>

<dt>rows, cols</dt>
<dd><p>Numeric vectors with row and column indices of
the non-zero elements in the lower triangle (including diagonal) of
the Hessian.</p></dd>

<dt>delta</dt>
<dd><p>The perturbation amount for finite difference (or
complex step) of the gradient to compute the Hessian.  Defaults to 1e-07.</p></dd>

<dt>index1</dt>
<dd><p>TRUE if rows and cols use 1-based (R format)
indexing (FALSE for 0-based (C format) indexing.</p></dd>

<dt>complex</dt>
<dd><p>TRUE if Hessian will be computed using the complex
step method, and FALSE (default) if using finite differences. If
TRUE, both fn and gr must accept complex arguments and return complex values.</p></dd>

<dt>...</dt>
<dd><p>other arguments to be passed to fn and gr.</p></dd>


</dl></div><p>Other methods are described below.  Do not access any of the
    fields directly.  The internal structure is subject to change in future versions.</p>
    </div>
    <div id="fields">
    <h2>Fields</h2>
    

<dl><dt><code>fn1</code></dt>
<dd><p>A closure for calling fn(x, ...).</p></dd>


<dt><code>gr1</code></dt>
<dd><p>A closure for calling gr(x, ...).</p></dd>


<dt><code>iRow,jCol</code></dt>
<dd><p>Numeric vectors with row and column indices of
the non-zero elements in the lower triangle (including diagonal) of
the Hessian.</p></dd>


<dt><code>delta</code></dt>
<dd><p>The perturbation amount for finite differencing of
the gradient to compute the Hessian. Defaults to 1e-07.</p></dd>


<dt><code>index1</code></dt>
<dd><p>TRUE if rows and cols use 1-based (R format)
indexing (FALSE for 0-based (C format) indexing.</p></dd>


<dt><code>complex</code></dt>
<dd><p>TRUE if Hessian will be computed using the complex
step method, and FALSE (default) if using finite differences.</p></dd>


<dt><code>D</code></dt>
<dd><p>raw finite differences (internal use only)</p></dd>


<dt><code>nvars</code></dt>
<dd><p>Number of variables (length of x)</p></dd>


<dt><code>nnz</code></dt>
<dd><p>Number of non-zero elements in the lower triangle of the Hessian.</p></dd>


<dt><code>ready</code></dt>
<dd><p>TRUE if object has been initialized, and Hessian has
been partitioned.</p></dd>


<dt><code>idx,pntr</code></dt>
<dd><p>Column indices and row pointers for non-zero
elements in lower triangle of the permuted Hessian.  Row-oriented
compressed storage.</p></dd>


<dt><code>colors</code></dt>
<dd><p>A vector representation of the partitioning of the columns.
There are nvars elements, one for each column of the permuted
Hessian.  The value corresponds to the "color" for that column.</p></dd>


<dt><code>perm,invperm</code></dt>
<dd><p>Permutation vector and its inverse</p></dd>


</dl></div>
    <div id="methods">
    <h2>Methods</h2>
    

<dl><dt><code>fn(x)</code></dt>
<dd><p>Return function value, evaluated at x: fn(x, ...)</p></dd>


<dt><code>fngr(x)</code></dt>
<dd><p>Return list of function value and gradient, evaluated at x</p></dd>


<dt><code>fngrhs(x)</code></dt>
<dd><p>Return list of function value, gradient, and Hessian, evaluated at x</p></dd>


<dt><code>get_invperm()</code></dt>
<dd><p>Return integer vector of inverse of permutation used for computing Hessian</p></dd>


<dt><code>get_nnz()</code></dt>
<dd><p>Return number of non-zero elements in lower triangle of Hessian</p></dd>


<dt><code>get_nvars()</code></dt>
<dd><p>Return dimension (number of rows or columns) of Hessian</p></dd>


<dt><code>get_pattern()</code></dt>
<dd><p>Return pattern matrix of lower triangle of Hessian</p></dd>


<dt><code>get_perm()</code></dt>
<dd><p>Return integer vector of permutation used for computing Hessian</p></dd>


<dt><code>get_perm_pattern()</code></dt>
<dd><p>Return pattern matrix of lower triangle of *permuted* Hessian</p></dd>


<dt><code>gr(x)</code></dt>
<dd><p>Return gradient, evaluated at x:  gr(x,...)</p></dd>


<dt><code>hessian(x)</code></dt>
<dd><p>Return sparse Hessian, evaluated at x, as a dgCMatrix object.</p></dd>


<dt><code>initialize(
  x,
  fn,
  gr,
  rows,
  cols,
  delta = 1e-07,
  index1 = TRUE,
  complex = FALSE,
  ...
)</code></dt>
<dd><p>Initialize object with functions to compute the objective function and gradient (fn and gr), row and column indices of non-zero elements (rows and cols), an initial variable vector x at which fn and gr can be evaluated, a finite differencing parameter delta, flags for 0 or 1-based indexing (index1), whether the complex step method will be used, and other arguments (...) to be passed to fn and gr.</p></dd>


<dt><code>partition()</code></dt>
<dd><p>Return the partitioning used to compute finite differences</p></dd>


<dt><code>pointers(out.index1 = index1)</code></dt>
<dd><p>Return list with indices (idx) and pointers (pntr) for sparsity pattern of the compressed sparse Hessian.  Since the Hessian is symmetric, the indices and pointers for row-oriented and column-oriented storage patterns are the same.</p></dd>


</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Log posterior density of hierarchical binary choice model. See vignette.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"binary_small"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">binary</span><span class="op">[[</span><span class="st">"Y"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">binary</span><span class="op">[[</span><span class="st">"X"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="va">binary</span><span class="op">[[</span><span class="st">"T"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="op">(</span><span class="va">N</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">k</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>inv.Sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/rWishart.html" class="external-link">rWishart</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">k</span><span class="op">+</span><span class="fl">5</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               inv.Omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">true.hess</span> <span class="op">&lt;-</span> <span class="fu"><a href="binary.html">binary.hess</a></span><span class="op">(</span><span class="va">P</span>, <span class="va">binary</span>, <span class="va">priors</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pattern</span> <span class="op">&lt;-</span> <span class="fu"><a href="Matrix.to.Coord.html">Matrix.to.Coord</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/band.html" class="external-link">tril</a></span><span class="op">(</span><span class="va">true.hess</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pattern</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ rows: int [1:1310] 1 2 3 4 201 202 203 204 2 3 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ cols: int [1:1310] 1 1 1 1 1 1 1 1 2 2 ...</span>
<span class="r-in"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">sparseHessianFD</span><span class="op">(</span><span class="va">P</span>, fn<span class="op">=</span><span class="va">binary.f</span>, gr<span class="op">=</span><span class="va">binary.grad</span>,</span></span>
<span class="r-in"><span>       rows<span class="op">=</span><span class="va">pattern</span><span class="op">[[</span><span class="st">"rows"</span><span class="op">]</span><span class="op">]</span>, cols<span class="op">=</span><span class="va">pattern</span><span class="op">[[</span><span class="st">"cols"</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                      data<span class="op">=</span><span class="va">binary</span>, priors<span class="op">=</span><span class="va">priors</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">hs</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">hessian</span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">hs</span>, <span class="va">true.hess</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## obj function</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## gradient</span></span></span>
<span class="r-in"><span><span class="va">fdf</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">fngr</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## list of obj function and gradient</span></span></span>
<span class="r-in"><span><span class="va">fdfhs</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">fngrhs</span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="co">## list of obj function, gradient and Hessian.</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://braunm.github.io" class="external-link">Michael Braun</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

